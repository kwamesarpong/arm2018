<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>ARM 2018 Ghana</title>
    
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">

    <link rel="stylesheet" href="css/style.css">

</head>
<body>
    <div class="container-fluid reset-padding">

        <div class="">

            <nav class="navbar navbar-expand-md bg-dark navbar-dark">
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                  <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="collapsibleNavbar">
                  <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                          About the event
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="wordchair.html">Word From the chair</a>
                            <a class="dropdown-item" href="logistics.html">Logistics</a>
                            <a class="dropdown-item" href="themeevent.html">Theme Event</a>
                            <a class="dropdown-item" href="prearm.html">Pre-ARM</a>
                            <a class="dropdown-item" href="postarm.html">Post-ARM</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="patrons.html">Patrons & Sponsors</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="discoverkumasi.html">Discover Kumasi</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="transport.html">Transportation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="organising.html">Organising Committee</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="visa.html">VISA</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="">Register|Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="contactus.html">Contact us</a>
                    </li>
                  </ul>
                </div>  
            </nav>

            <br />

            <div class="container log-out">
                <div class="row">
                    <div class="col-md-8 text-center">
                        <!-- <div class="sub-header loading-message-div">
                            <p id="waitloading" class="loading-message"></p>
                        </div> -->
                        <button type="button" id="lodmod" class="btn btn-primary loading-modal" data-toggle="modal" data-target="#myModal">
                            Open modal
                        </button>
                    </div>
                    <div class="col-md-4 text-right">
                        <button onclick="event.preventDefault(); logOut();">Log out</button>
                    </div>
                </div>
            </div>

            <br /><br />

            <div class="container">
                <div class="regform-card">
                    <div class="regform-card-title">
                        <h4 class="sub-header">ARM 2018 Ghana Registration Form</h4>
                    </div>
                    <div class="regform-padding">
                        <p>Other Information</p>
                        <div class="progress fif-progress">
                            <div class="progress-bar fif-progress-bar"></div>
                        </div>
                        <br />
                        <br />
                        <div class="signup-form">

                            <form onsubmit="event.preventDefault(); submitUpdatedData();">
                                <div class="row">

                                    <div class="col-md-6">
                                        <br />
                                        <h6 class="sub-header">Emergency Contact Person Name</h6>
                                        <p class="sub-header"><input type="text" name="emergencycontactfirstName" id="emergencyContactFirstName" required /></p>
                                        <br />

                                    </div>

                                    <div class="col-md-6">
                                        <br />
                                        <h6 class="sub-header">Emergency Contact Person Number</h6>
                                        <p class="sub-header"><input type="number" name="emergencycontactnumber" id="emergencyContactNumber" min="0" oninput="validity.valid||(value='');" required /></p>
                                        <br />
                                    </div>

                                    <div class="col-md-6">
                                        <br />
                                        <h6 class="sub-header">Emergency Contact Person Email</h6>
                                        <p class="sub-header"><input type="email" name="emergencycontactemail" id="emergencyContactEmail" required /></p>
                                        <br />
                                    </div>

                                    <div class="col-md-6">
                                            <br />
                                            <h6 class="sub-header">Special Diet / Allergies / Medical Condition we should know about</h6>
                                            <p class="sub-header"><input type="text" name="specialdiet" id="specialDiet" required /></p>
                                            <br />
                                        </div>

                                </div>
                                <br /><br />

                                <div class="row">
                                    <div class="col-md-6 text-center">
                                        <div class="sub-header wait-color" id="returnSuccess"></div>
                                        <div class="sub-header fail-color" id="returnError"></div>
                                    </div>
                                    <div class="col-md-3 text-center previous-page-padd">
                                        <!-- <button class="sub-header">Previous Page</button> -->
                                        <a href="fourthform.html" class="sub-header next-page-link">Previous Page</a>
                                    </div>
                                    <div class="col-md-3">
                                        <button type="submit" class="sub-header">Save Everything</button>
                                    </div>
                                </div>
                            </form>

                        </div>
                        
                    </div>
                </div>
            </div>
            
        </div>

        <br /><br /><br />

        
            <div class="footer">
                <div class="row">
                    <div class="col-md-12 text-center">
                        <p class="sub-header">Copyright &copy; 2018 FGMSA-GHANA</p>
                    </div>
                </div>
            </div>

            <!-- The Modal -->
            <div class="modal fade modal-position" id="myModal">
                <div class="modal-dialog">
                <div class="modal-content">
                    
                    <!-- Modal body -->
                    <div class="modal-body text-center">
                        <p class="sub-header modal-body-padd">Please wait ...</p>
                        <button type="button" id="closeMod" class="btn btn-danger loading-modal" data-dismiss="modal">Close</button>
                    </div>
                    
                </div>
                </div>
            </div>
        

    </div>
    


    <script src="https://fgmsa.herokuapp.com/js/devless-sdk.js" class="devless-connection" devless-con-token="13cb9695a2e39140de7895dda9a24e24"  ></script>

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

    <script type="text/javascript">
        window.onload = checkStatus;

        $(function () {
            $(":file").change(function () {
                if (this.files && this.files[0]) {
                    var reader = new FileReader();
                    reader.onload = imageIsLoaded;
                    reader.readAsDataURL(this.files[0]);
                }
            });
        });

        function imageIsLoaded(e) {
            $('#myImg').attr('src', e.target.result);
        };

        function logOut() {
            localStorage.removeItem('userToken');
            localStorage.removeItem('userEmail');
            window.location.href = "/login.html";
        };

        function checkStatus() {
            var userToken = localStorage.getItem('userToken');
            var userEmail = localStorage.getItem('userEmail');

            if (!userToken && !userEmail) {
                window.location.href = "/login.html";
            }
            else {

                document.getElementById("lodmod").click();

                params={
                    where:["email," + userEmail]
                };

                SDK.queryData("conferenceForm", "otherinfo", params, function(response){
                    console.log(response);

                    document.getElementById("emergencyContactFirstName").value = response.payload.results[0].emergencycontactfullname;
                    document.getElementById("emergencyContactNumber").value = response.payload.results[0].emergencycontactnumber;
                    document.getElementById("emergencyContactEmail").value = response.payload.results[0].emergencycontactemail;
                    document.getElementById("specialDiet").value = response.payload.results[0].specialdiet;

                    document.getElementById("closeMod").click();
                });
                
            }

        };

        function submitUpdatedData() {

            document.getElementById("lodmod").click();

            var emergencyContactFullName = document.getElementById("emergencyContactFirstName").value;
            var emergencyContactNumber = document.getElementById("emergencyContactNumber").value;
            var emergencyContactEmail = document.getElementById("emergencyContactEmail").value;
            var specialDiet = document.getElementById("specialDiet").value;

            var obtainedEmail = localStorage.getItem('userEmail');
            
            data = {
                "emergencycontactfullname": emergencyContactFullName,
                "emergencycontactnumber": emergencyContactNumber,
                "emergencycontactemail": emergencyContactEmail,
                "specialdiet": specialDiet
            }

            SDK.updateData("conferenceForm", "otherinfo", "email", obtainedEmail, data,
                function(response){
                    console.log(response);
                    if (response.status_code === 619) {
                        document.getElementById("closeMod").click();
                        document.getElementById("returnSuccess").innerHTML = "Congratulations. You have successfully registered for the event. You can log out and log in anytime to update your details. Thank you.";
                    }
                    else {
                        document.getElementById("closeMod").click();
                        document.getElementById("returnError").innerHTML = "Cannot save details at this time. Please try later!";
                    }
                });

        }
    </script>
</body>

</html>